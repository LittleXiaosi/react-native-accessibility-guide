<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>无障碍的相关问题汇总 | react-native无障碍指南</title>
    <meta name="generator" content="VuePress 1.5.0">
    
    <meta name="description" content="">
    <link rel="preload" href="/react-native-accessibility-guide/assets/css/0.styles.86e37cfc.css" as="style"><link rel="preload" href="/react-native-accessibility-guide/assets/js/app.017561ca.js" as="script"><link rel="preload" href="/react-native-accessibility-guide/assets/js/2.32760985.js" as="script"><link rel="preload" href="/react-native-accessibility-guide/assets/js/7.032d2c77.js" as="script"><link rel="prefetch" href="/react-native-accessibility-guide/assets/js/3.d07fa4b8.js"><link rel="prefetch" href="/react-native-accessibility-guide/assets/js/4.a29469eb.js"><link rel="prefetch" href="/react-native-accessibility-guide/assets/js/5.6592ffa6.js"><link rel="prefetch" href="/react-native-accessibility-guide/assets/js/6.dcbfc26b.js">
    <link rel="stylesheet" href="/react-native-accessibility-guide/assets/css/0.styles.86e37cfc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/react-native-accessibility-guide/" class="home-link router-link-active"><!----> <span class="site-name">react-native无障碍指南</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/react-native-accessibility-guide/" aria-current="page" class="sidebar-link">Hello VuePress!</a></li><li><a href="/react-native-accessibility-guide/react-native-accessibility-attr-test.html" class="sidebar-link">无障碍属性实测各类问题</a></li><li><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html" aria-current="page" class="active sidebar-link">无障碍的相关问题汇总</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#信息传递" class="sidebar-link">信息传递</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#金额：" class="sidebar-link">金额：</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_1-时间：" class="sidebar-link">1.时间：</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_2-符号：" class="sidebar-link">2.符号：</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_3-字符串数字" class="sidebar-link">3.字符串数字</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_4-语序" class="sidebar-link">4.语序</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_5-多音字" class="sidebar-link">5.多音字</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_6-辅助文案" class="sidebar-link">6. 辅助文案</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#属性支持" class="sidebar-link">属性支持</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_1-元素角色" class="sidebar-link">1. 元素角色</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_2-元素值" class="sidebar-link">2.元素值</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_3-h5代码" class="sidebar-link">3.H5代码</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#交互设计" class="sidebar-link">交互设计</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_1-读屏交互模式" class="sidebar-link">1.读屏交互模式</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_2-错误提示" class="sidebar-link">2.错误提示</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_3-逻辑" class="sidebar-link">3.逻辑</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_4-跑马灯提示" class="sidebar-link">4.跑马灯提示</a></li></ul></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#焦点控制" class="sidebar-link">焦点控制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_1-行内链-要改-已有解决方案" class="sidebar-link">1.行内链—要改--已有解决方案</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_2-弹窗穿透：" class="sidebar-link">2.弹窗穿透：</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_3-页面穿透" class="sidebar-link">3.页面穿透</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_4-焦点分拆" class="sidebar-link">4.焦点分拆</a></li><li class="sidebar-sub-header"><a href="/react-native-accessibility-guide/react-native-accessibility-bug-list.html#_5-焦点跳转" class="sidebar-link">5.焦点跳转</a></li></ul></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="无障碍的相关问题汇总"><a href="#无障碍的相关问题汇总" class="header-anchor">#</a> 无障碍的相关问题汇总</h1> <h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>​	在最开始处理无障碍问题的时候，其实想法很简单，既然RN有现成的无障碍属性，那不就是只要把对应的属性添加上去就好了？当然现实总是要比理想骨感很多，我们实际遇到的很多问题，是无法简单的通过一两个无障碍支持的属性（更别提有的属性支持很奇怪了）以下就是我们之前遇到的一些问题的汇总</p> <h2 id="信息传递"><a href="#信息传递" class="header-anchor">#</a> 信息传递</h2> <p><em>​	这类错误主要是因为信息传递不足导致的，核心原因就是因为TTS读屏的时候，不能将<strong>屏幕语言</strong>朗读成<strong>日常语言</strong>，这种情况下，信息在传递的时候，传递给视障用户的时候，可能有偏差，或者需要额外的理解成本</em></p> <h3 id="金额："><a href="#金额：" class="header-anchor">#</a> 金额：</h3> <ul><li>问题案例：显示 <strong>2345.23</strong>元 需要朗读为<strong>两千三百四十五元两角三分</strong>，或者<strong>两千三百四十五点二三元</strong>，但是TTS在读屏幕的时候，不一定会这么朗读，比如<strong>两千三百四十五点二十三</strong>这种朗读，就会比较奇怪。</li> <li>解决方式：金额是典型的日常用语与显示不一致的问题，这种情况下，为了保证重要金额数字朗读的准确性，需要额外转化为中文，也就是直接在<code>accessibilityLabel</code>里面写入<strong>两千三百四十五元两角三分</strong>直接朗读中文</li></ul> <h3 id="_1-时间："><a href="#_1-时间：" class="header-anchor">#</a> 1.时间：</h3> <ul><li>问题案例：显示<strong>2020-06-20</strong>的时候，需要朗读为<strong>2020年6月20日</strong></li> <li>解决方案：同金额处理，需要额外在<code>accessibilityLabel</code>里面添加中文</li></ul> <h3 id="_2-符号："><a href="#_2-符号：" class="header-anchor">#</a> 2.符号：</h3> <ul><li>问题案例：在特定内容中，<strong>1+2*3/4-5</strong>是需要朗读为<strong>1加2乘3除4减5</strong>，但是通常会朗读为<strong>1加号2星号3斜杠45</strong>，就是同一个符号，在不同的情况下表达的含义是不一样的，所以读法也会不一样</li> <li>解决方案：与金额类似，需要手动转化为中文处理</li></ul> <h3 id="_3-字符串数字"><a href="#_3-字符串数字" class="header-anchor">#</a> 3.字符串数字</h3> <ol><li>电话号码</li> <li>银行卡号
<ul><li>问题案例：这两种数字都是类似的问题，在正常语言环境中，我们不认为这些数字是可计算数字，所以需要额外按照字符串的处理，</li> <li>解决方案：把罗马数字转化为中文字符串放在<code>accessibilityLabel</code>中</li></ul></li></ol> <h3 id="_4-语序"><a href="#_4-语序" class="header-anchor">#</a> 4.语序</h3> <ul><li>问题案例：很多设计稿在设计的时候，不完全遵循从上到下，从左到右的默认浏览数据，尤其是一些描述文字或者角标等等。</li> <li>解决方案：重新在<code>accessibilityLabel</code>排列为希望展现的语序</li></ul> <h3 id="_5-多音字"><a href="#_5-多音字" class="header-anchor">#</a> 5.多音字</h3> <ul><li>问题案例：在朗读文案的时候，多音字会导致文案意思不一致，比如“我行(xíng)走在时代的前列”，“我行(háng)走在时代的前列”，这种情况下，两句话都是对的，但是意思不一样，但是TTS是识别不了，应该读取哪种文案的</li> <li>解决方案：替换文案，或者直接忽略这个bug（PS：多音字是中文语言环境下的特有问题，是没有办法直接通过技术能力解决的）</li></ul> <h3 id="_6-辅助文案"><a href="#_6-辅助文案" class="header-anchor">#</a> 6. 辅助文案</h3> <ul><li>问题案例：在用户选择到Banner图片或者是宣传图片的时候，朗读的信息其实会是**“图片”<strong>或者是</strong>“xxx.png”**的内容，那这部分内容是需要额外朗读出来的</li> <li>解决方案：添加相关描述文案，语音朗读对应的图片文案</li></ul> <h2 id="属性支持"><a href="#属性支持" class="header-anchor">#</a> 属性支持</h2> <h3 id="_1-元素角色"><a href="#_1-元素角色" class="header-anchor">#</a> 1. 元素角色</h3> <ul><li><p>案例：这个主要就是需要给能够响应无障碍焦点的元素添加一个说明，<code>accessibilityRole</code>属性的设置，本身并不复杂</p></li> <li><p>解决方案：设置<code>accessibilityRole</code>的属性为对应的元素，这样朗读的时候就有对应的文案，比如下面这种情况就会读为**&quot;点击，按钮&quot;**</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">accessibilityRole</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'button'</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点击</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>注意事项：React-Native支持的属性有二十多种，但是！！！并不是所有的属性，都有对应的中文翻译，也就是需要自行翻译，我们和深圳无障碍协会确认过之后，使用了一套比较靠谱的翻译文案，详情在另一文章中会详细讲解</p></li></ul> <h3 id="_2-元素值"><a href="#_2-元素值" class="header-anchor">#</a> 2.元素值</h3> <ul><li>案例：这个主要就是针对一些带值的属性说明，<code>accessibilityState</code>属性的设置主要就是针对比如按钮可点不可点的状态，选择框当前是不是被选中的状态，滑块当前的值等等，这些也是视障用户需要知道的值</li> <li>解决方案：设置<code>accessibilityState</code>对应的值，就可以有对应的朗读文案，比如下面这种情况就会读为**“点击，按钮，已禁用”<strong>（安卓）</strong>“点击，按钮，变暗”**（iOS）</li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">accessibilityRole</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'button'</span><span class="token punctuation">}</span></span> <span class="token attr-name">accessibilityState</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>disabled<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点击</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li>这个属性依旧有安卓和iOS不同意，中英文翻译不一致的问题，和上面的 <code>accessibilityRole</code>一样，我们也标准化了整个状态朗读的中文，解决了本地化的问题</li></ul> <h3 id="_3-h5代码"><a href="#_3-h5代码" class="header-anchor">#</a> 3.H5代码</h3> <ul><li>问题案例：我们以上所有的问题，都是属于RN的优化范围，但是Webview内的无障碍优化其实是属于H5的优化范畴，所以需要H5的开发团队额外处理</li> <li>解决方案：遵循W3C的无障碍属性，其实相对而言，H5对无障碍的支持要比RN好一些，至少不需要自己来翻译控件名字，而且基本上现在的App</li></ul> <h2 id="交互设计"><a href="#交互设计" class="header-anchor">#</a> 交互设计</h2> <h3 id="_1-读屏交互模式"><a href="#_1-读屏交互模式" class="header-anchor">#</a> 1.读屏交互模式</h3> <ul><li>这个地方需要特别考虑iOS和安卓的交互模式不一样，
<ul><li>iOS没有滚动的概念，三指头滑屏幕实际上是在**“翻页”**（不知道是不是考虑到视障用户记页码对应内容比较方便，这么设计）</li> <li>Android有滚动的概念，安卓的双指滚动实际上和我们平时的**“滚动”**表现是一致的</li> <li>基于这种最基本的交互模式的不同，iOS有个非常常见的问题，对我们现在已经非常熟悉的操作**“下拉刷新”**其实iOS用户是很不方便的，
<ul><li>翻页不能直接触发刷新，要看实现逻辑，</li> <li>即使实现了刷新，但是每一页码对应的内容就变化了，其实达不到记忆页码对应内容的效果</li> <li>要额外提示用户，“总共三页，当前第一页，向下滚动到第0页刷新”</li></ul></li> <li>另外针对Android手机，其实市面上的读屏软件也是五花八门，能够支持的手势十分强大，比如Z操作是回到主屏幕，反Z操作是触发编辑模式等等，异常强大和丰富，这部分的手势基本上都是TTS自行支持，App端直接忽略就好</li></ul></li> <li>解决方案：因为我们App并不是内容类的App，所以没有那么强的信息更新诉求，虽然首页有这个操作，但是不操作影响也不大，所以就没有强提示用户了。</li></ul> <h3 id="_2-错误提示"><a href="#_2-错误提示" class="header-anchor">#</a> 2.错误提示</h3> <ul><li>这个地方是比较容易忽略的地方，尤其是在UI输入的时候，很多时候，我们在明眼人的设计里面，通过按钮变灰，边框变红，文字置灰等等，可以用来提示很多信息，但是面对无障碍的设计的时候，这一些提示是达不到传递信息的目的的，所以需要有额外处理</li> <li>解决方案：关键节点控制，典型的Form表单提交的时候，在焦点放在提交按钮的时候，
<ul><li>需要在这个按钮上提示用户输入是否成功，以及如果不成功的话是哪一个Label出了问题，以及问题是什么，这样至少兜底能够保证用户在关键的提交流程，会获得足够的信息，保证流程能够走下去</li> <li>另外可以通过<code>AccessibilityInfo.announceForAccessibility(msg)</code>方法来主动发送小tips的提示，比如说红框周边的文案，这样在不切换焦点的时候，用户也能收到对于的错误提示</li></ul></li></ul> <h3 id="_3-逻辑"><a href="#_3-逻辑" class="header-anchor">#</a> 3.逻辑</h3> <ul><li>这种情况其实也是很普遍而且不容易发现的，因为项目总是先上线迭代满足功能，然后再来无障碍优化，但是这中间就会涉及到不少之前根本没有考虑过视障用户的问题，比如说图文教程，视频教程，语音读屏幕上的文字来校验身份等等，这些都是视障用户没法用，但是前期都没考虑过的问题。</li> <li>解决方案：寻求视障用户的替代方案，具体情况还是得依照用户场景而定，比如微众银行App就针对刷脸验证身份，专门提供了一个语音提示，指导怎么移动手机来对准正脸</li></ul> <h3 id="_4-跑马灯提示"><a href="#_4-跑马灯提示" class="header-anchor">#</a> 4.跑马灯提示</h3> <ul><li>这也是一个明眼人下意识会忽略的问题，典型的就是宣传位，尤其是Banner位，通常Banner位有多张图，但是依据TTS的不一致，用户不一定能意识到这是个Banner，可能读屏的时候，只会读出这是一张图片（如果Banner位的辅助说明不足的话），而且也不知道还有其他图片，那么这种事情，Banner自动轮播切图片了，需不需要自动读新的内容，主动告诉用户图片切换了呢？这里就会有个问题，如果通知用户，那么Banner一直切，TTS就一直念，很吵。如果不通知，剩下的图片其实是无法触达用户的</li> <li>解决方案：优先保证体验，不念，因为在RN现有能力里面，是不能监控到当前焦点在哪里的，焦点变化并没有对应的回调函数，比较理想的状态是找到方法能够拿到当前焦点的位置和回调，判断焦点在Banner位的时候，再进行提醒。PS：之前提到的RN支持的控件类型，并没有Banner这种类型</li></ul> <h2 id="焦点控制"><a href="#焦点控制" class="header-anchor">#</a> 焦点控制</h2> <p>焦点控制是一个在无障碍里面比较重要的部分，所以单独列开来说</p> <h3 id="_1-行内链-要改-已有解决方案"><a href="#_1-行内链-要改-已有解决方案" class="header-anchor">#</a> 1.行内链—要改--已有解决方案</h3> <ul><li><p>问题案例：这个问题在RN的iOS上非常明显，表现是在于这样一种代码结构下，在iOS开启VoiceOver的情况下，整行字是同一个焦点，即**“文案1文案2文案3文案4”<strong>整个一句话作为一个可触发的焦点，这样的情况下，<code>onPress</code>会触发的函数是不一定的，如果文案是英文的话，那么会触发<code>debugger4</code>，但是如果文案是中文的话，会和文字的字数有关，大概率触发的回调函数会是</strong>字数最多**的那个。</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger1'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    文案1
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        文案2
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger3'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            文案3
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger4'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            	文案4
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>解决方案：因为焦点聚合，所以只可能触发某一个回调函数，通过无障碍单独的响应监听，添加指定的想要处理的回调，这个时候直接监听最外层的Text，把外层要处理的回调来监听</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token operator">&lt;</span>Text 
    onPress<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger1'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span> 
    accessible<span class="token operator">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span> 
    accessibilityActions<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">'activate'</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>  
    <span class="token function-variable function">onAccessibilityAction</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>nativeEvent<span class="token punctuation">.</span>actionName <span class="token operator">===</span> <span class="token string">'activate'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger4'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token operator">&gt;</span>
    文案<span class="token number">1</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger2'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        文案2
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger3'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            文案3
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'debugger4'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            	文案4
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_2-弹窗穿透："><a href="#_2-弹窗穿透：" class="header-anchor">#</a> 2.弹窗穿透：</h3> <ul><li><p>问题案例：在一般的App设计中，弹窗是一个非常常见的问题，我们通过弹窗+遮罩层，可以实现用户聚焦在当前弹窗，聚焦用户的操作，做到流程的控制或者是强聚焦用户视觉作用，被遮罩层盖住的部分，因为点击事件被弹窗阻断，所以不会误操作被遮罩层盖住部分。但是在无障碍的操作上却不是这样的，即使被遮罩层盖住之后，但是对于TTS而言，节点依然存在，所以TTS依然是可以聚焦到被遮罩层盖住的元素。这就是典型的弹窗穿透</p></li> <li><p>解决方案：在弹窗出现的时候，判断是否有遮罩层，如果有遮罩层的话，在被盖住的节点的最外层的<code>&lt;View&gt;</code>上面添加这两个属性，即可屏蔽所有</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span>  <span class="token attr-name">accessibilityElementsHidden</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span> <span class="token attr-name">importantForAccessibility</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'no-hide-descendants'</span><span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>注意：</p> <ul><li>中文的React-native网站上对于<code>importantForAccessibility</code>属性的demo是错误的，'no-hide-descendants'这个属性最后有一个s，不能漏掉</li> <li>如果在你的项目中使用了<code>react-navigation</code>，那么你需要添加属性的<code>View</code>有可能是在<code>react-navigation</code>中<code>render</code>的，这种情况下，需要额外处理。比如我们的项目，因为使用的是旧版本的<code>react-navigation</code>，所以需要额外改包里面的代码。</li></ul></li></ul> <h3 id="_3-页面穿透"><a href="#_3-页面穿透" class="header-anchor">#</a> 3.页面穿透</h3> <ul><li><p>问题案例：这个问题很特别，基本上只会出现在iOS上面，原因和App本身页面切换的逻辑是有关系的，如果App在切换页面的时候，旧的页面没有消失，只是被覆盖的话，有小几率会出现VoiceOver的焦点还在旧的页面上，也就是视觉上切换到了新页面，但是交互被保留在旧的页面上了</p></li> <li><p>解决方案：通过设置<code>accessibilityViewIsModal</code>属性来禁止被覆盖的元素的响应（因为是当前页面的兄弟元素），另外，其实在切换页面的时候，应该主动切换焦点到新页面上，这部分会在<strong>焦点控制</strong>中说明</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">accessibilityViewIsModal</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li></ul> <h3 id="_4-焦点分拆"><a href="#_4-焦点分拆" class="header-anchor">#</a> 4.焦点分拆</h3> <ul><li><p>问题案例：这个问题在iOS上面特别明显，和上文提到的<code>Text</code>问题表现有点类似。表现就在于</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPress1<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPress2<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            	xxxx
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPress3<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            	xxxx
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在这种嵌套的按钮结构中，RN的iOS是无法响应里面的onPress2事件和onPress3事件，只会响应到外部的onPress1事件，原因就是在<code>node_modules/react-native/React/Views/RCTView.m</code>这个文件中的<code>- (BOOL)isAccessibilityElement</code>判断是有问题的，并不会主动向下寻找其他可以触发的节点。所以这个地方其实是RN本身的bug，我们的同事已经提了<a href="https://github.com/facebook/react-native/pull/29142" target="_blank" rel="noopener noreferrer">https://github.com/facebook/react-native/pull/29142<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>这个PR</p></li> <li><p>解决方案：通过新增分割焦点属性，主动分割字节点出来使用</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPress1<span class="token punctuation">}</span></span> <span class="token attr-name">accessibilitySplitFocus</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPress2<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span> <span class="token attr-name">accessible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            	不推荐的做法
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">TouchableOpacity</span></span> <span class="token attr-name">onPress</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>onPress3<span class="token punctuation">}</span></span> <span class="token attr-name">pointerEvents</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token string">'box-only'</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        	</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
            	推荐的做法
            </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">View</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">TouchableOpacity</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这里特别说一下，这么改的目的：<code>accessibilitySplitFocus</code>这个属性是用来分割焦点的，仅在iOS上生效，设置之后，里面的字元素如果设置了<code>accessible</code>这个属性，那么就可以获取到焦点了。但是这个地方的焦点是不包括字元素的<code>&lt;TouchableOpacity&gt;</code>的，在<code>&lt;View accessible={true}&gt;</code>的情况下能够获取到焦点，确实可以通过点击第一个<code>&lt;View&gt;</code>来触发<code>onPress2</code>，但这么做会引起其他的问题</p> <ul><li>在<strong>Android</strong>上，<strong>“不推荐做法”<strong>这个按钮会有两个焦点，一个朗读为</strong>“不推荐做法”</strong>，焦点是在<code>&lt;View&gt;</code>上面，一个朗读为**“不推荐做法，按钮”<strong>，这个焦点是在<code>&lt;TouchableOpacity&gt;</code>上面；但是在</strong>iOS<strong>的表现，是只有一个焦点为</strong>“不推荐做法”**，就是这个<code>&lt;View&gt;</code></li> <li>所以为了解决这个问题，我们把<code>&lt;TouchableOpacity&gt;</code>的<code>pointEvents</code>事件向下传递（这个地方也是需要改RN的代码）因为里面的<code>&lt;View&gt;</code>虽然不能被TTS找到，因为不支持无障碍，但是可以响应事件，这样就使得<code>&lt;TouchableOpacity&gt;</code>被响应到，而被TTS聚焦。</li></ul></li></ul> <h3 id="_5-焦点跳转"><a href="#_5-焦点跳转" class="header-anchor">#</a> 5.焦点跳转</h3> <ul><li><p>问题案例：页面切换，弹窗弹出这两种交互形式，本质上都是替换了用户交互区域，所以在这个过程中，一定要给予用户足够的提示，告诉用户可操作区域是变化了的。所以在切换页面和弹窗的时候（包括全屏遮罩，半屏的键盘出现，广告位出现等等）需要主动把焦点跳转到对应的操作title。需要主动告知用户当前UI的变化，不然用户就很难理解上一步的操作是干了什么，产生了什么效果。一个简单的例子就是二次确认，当出现二次确认按钮的时候，需要把焦点跳转到弹窗的文字上面，不然用户原来的可操作区域变为不可操作了（上文提到了弹窗点击穿透问题解决之后）用户需要手动寻找可操作区域，这个体验就非常的反人类。</p></li> <li><p>解决方案：通过主动寻找到对应的焦点，通常是<code>&lt;Text&gt;</code>来作为需要读取的文案（这个地方特别注意，如果把焦点放在自定义组件上面，可能会导致焦点找不到这个组件，或者不知道朗读什么）这样就可以在跳转或者弹窗的时候，有对应的焦点变化。</p></li> <li><div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AccessibilityInfo<span class="token punctuation">,</span> findNodeHandle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-native'</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Text</span></span> 
    <span class="token attr-name">accessible</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token boolean">true</span><span class="token punctuation">}</span></span> 
    <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter">ref</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> reactTag <span class="token operator">=</span> <span class="token function">findNodeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">)</span>
        AccessibilityInfo<span class="token punctuation">.</span><span class="token function">setAccessibilityFocus</span><span class="token punctuation">(</span>reactTag<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>        
<span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Text</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div></li> <li><p>注意事项：如果使用了<code>react-navigation</code>那么这个<code>&lt;Text&gt;</code>可能不是在你自己的代码里面，需要额外处理。我们这边因为是使用了版本非常旧的<code>react-navigation</code>所以是需要改库文件的。</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/react-native-accessibility-guide/react-native-accessibility-attr-test.html" class="prev">
        无障碍属性实测各类问题
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/react-native-accessibility-guide/assets/js/app.017561ca.js" defer></script><script src="/react-native-accessibility-guide/assets/js/2.32760985.js" defer></script><script src="/react-native-accessibility-guide/assets/js/7.032d2c77.js" defer></script>
  </body>
</html>
